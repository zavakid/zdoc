
<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />
  <title>内存学习——为什么需要虚拟内存</title>
  
  

  <link rel="alternate" type="application/rss+xml" title="说者无意 &raquo; Feed" href="/atom.xml" />
  <link rel="stylesheet" href="/assets/themes/foundation/stylesheets/foundation.min.css">
  <link rel="stylesheet" href="/assets/themes/foundation/stylesheets/app.css">
  <link rel="stylesheet" href="/assets/themes/foundation/hl/styles/tomorrow-night-bright.css">
  <script src="/assets/themes/foundation/javascripts/jquery.min.js"></script>
  <script src="/assets/themes/foundation/javascripts/foundation.min.js"></script>
  <script src="/assets/themes/foundation/hl/highlight.pack.js"></script>
  <script src="/assets/themes/foundation/javascripts/app.js"></script>
</head>

<body>
  <!-- Nav Bar -->
<div class="row">
  <div class="twelve columns">
    <nav class="top-bar">
      <ul>
        <!-- Title Area -->
        <li class="name">
        <h2>
          <a href="/">
            说者无意
          </a>
        </h2>
        </li>
      </ul>
      <section>
      <!-- Left Nav Section -->
      <ul class="left">
        <li class="divider"></li>
        
        
        


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">存档</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  




        <li class="divider hide-for-small"></li>
      </ul>
      </section>
    </nav>
  </div>
</div>
<!-- End Nav -->


  <!-- Main Page Content and Sidebar -->
  <div class="row">
    <!-- Main Blog Content -->
<div class="eight columns content" role="content">
  
<h1>内存学习——为什么需要虚拟内存</h1>
<article>
<p>关于虚拟内存，物理内存，我有蛮多概念都是很模糊的，今天下午看了一下虚拟内存，也算是有了一点小收获，本文就针对为什么需要有虚拟内存的理解写下来。</p>

<p>同时，我也希望自己能够陆续学习linux内存管理的知识，并且写出一些文章，来记录自己的一些理解。 如果您觉得有任何问题，可以留下评论，我们一起讨论，毕竟越辩越明。</p>
<h3>为什么要使用虚拟内存</h3>
<p>之前的计算机系统，是使用物理地址来使用内存的，这样，CPU就根据某个寄存器中相应的值，直接到物理内存去取值了。 这样的好处就是非常直接，非常容易理解。</p>

<p>而缺点是，我们需要知道物理地址的值，每次程序开始执行，也就是执行程序从磁盘被load到物理内存中之后，我们必须告诉CPU，程序是从哪一个地址开始执行的（即PC寄存器的值）；还有一个致命的缺点是：程序使用的内存会被物理内存所限制，比如我们的机器上只有512M内存，那我们的程序就不能使用需占1G内存的程序了。这点或许是催生虚拟内存产生的最主要原因。</p>
<h3>虚拟内存的概念</h3>
<p>为了解决上面的的问题，就产生了虚拟内存的概念。那什么是虚拟内存呢？这里我先说说自己对<strong>存储器层次结构</strong>的理解。</p>

<p>计算机中有一种存储器层次的原则。我的理解是，CPU使用的数据都是基于寄存器的，如果我们的寄存器足够的大和多并且足够便宜，那么也就没有后来那么多的东西产生了。而问题就是寄存器足够快，但其造价却非常昂贵，因此，考虑到成本，就有了之后的CPU高速缓存，主存（就是我们常说的内存）和硬盘，甚至磁带等存储器了。</p>

<p>那么，计算机是如何让这些速度快慢不一、容量大小不一的存储器在一起工作的呢？一个方案就是<strong>存储器层次结构</strong>。</p>

<p>对于这个存储器层次结构，我的理解是：CPU是和寄存器打交道的，但寄存器的容量毕竟有限，因此就需要高速缓存存储器来作为寄存器的缓存，当有些数据在寄存器中找不到时，CPU就可以去寻找高速缓存这个存储器中的内容，如果告诉缓存器还没有这个数据，那我就去主存中再去寻找这个数据，如果主存中也还没有，那就去磁盘中找吧。</p>

<p>这也是我对存储器层次结构的一个理解。</p>

<p>以上说了一通，但都没有提到虚拟内存，那虚拟内存究竟是什么？他在这个层次中处于哪个位置呢？</p>

<p>实际上，按照这种模型去思考的话，就可以这样理解：<strong>虚拟内存就是去解决主存到磁盘这个层次的方案</strong>。</p>

<p>没错，我认为虚拟内存就是一种方案，而且他是非常重要的，为什么呢？众所周知，CPU的速度很快，内存就是作为匹配CPU和磁盘之间速度的一个中间层，高速缓存其实也是这样一个缓存的角色，但问题是，如果高速缓存失效，那么CPU会去访问内存，这样的速度只是降低了十倍的数量级；而如果是内存失效，让CPU去访问磁盘的话，这样的速度却是降低了十万倍到百万倍的数量级。</p>

<p>可见，在寄存器、高速缓存和主存之间缓存的失效，结果还是可以让人接受的（想想java的volatile关键字），但主存和磁盘之间缓存的失效，就会给程序造成比较大的性能影响了，所以我们应该努力避免主存的失效，这也是虚拟内存所必须要解决和面对的问题之一。</p>
<h3>总结</h3>
<p>其实可以认为，程序使用的内存，都是用的虚拟内存，因此也就没有了物理内存的限制（但还是限制于计算机的寻址位数，比如32位和64位，因为虚拟内存系统需要使用到物理内存）。他可以把自己的一部分放在物理内存中，还有一部分当做缓存放到磁盘中。另外，虚拟内存有相应的虚拟地址，因此，他就可以做到对于每一个程序来说，使用的都是相同的虚拟地址，这些虚拟地址，则可以映射到不同的物理地址，也就是说每个程序都可以把自己想象成自己拥有整台机器的内存。</p>
</article>

<hr/>
<dl class="tabs">
  <dd><a href="#postMeta">文章信息</a></dd>
  <dd class="active"><a href="#related">相关文章</a></dd>
  <dd class="hide-for-small"><a href="#otherRead">别人也读过</a></dd>
</dl>
<ul class="tabs-content">

  <li id="postMetaTab">
    <dl class="sub-nav">
      
      <dt>分类:</dt>
      
      <dd><a href="/categories.html#linux-ref">linux</a></dd>
      
      
    
      
      <dt>标签:</dt>
        
        <dd><a href="/tags.html#cache-ref">cache</a></dd>
        
        <dd><a href="/tags.html#Linux-ref">Linux</a></dd>
        
        <dd><a href="/tags.html#为什么有虚拟内存-ref">为什么有虚拟内存</a></dd>
        
        <dd><a href="/tags.html#内存-ref">内存</a></dd>
        
        <dd><a href="/tags.html#存储器层次结构-ref">存储器层次结构</a></dd>
        
        <dd><a href="/tags.html#虚拟内存-ref">虚拟内存</a></dd>
        
        
    </dl>
  </li>

  <li class="active" id="relatedTab">
  
    <ul class="circle">
    
    <li><a href="/2011/10/22/virtual-memory">内存学习——虚拟内存</a></li>
    
    <li><a href="/2011/11/17/tokyo-tyrant-vs-redis">Tokyo Tyrant 与 Redis 的一些简单比较</a></li>
    
    <li><a href="/2011/07/30/unix-io-model">关于IO的同步,异步,阻塞,非阻塞</a></li>
    
    <li><a href="/2013/01/21/pattern_learn">模式学习笔记-体系结构模式-2</a></li>
    
    <li><a href="/2012/07/31/resolved_ubuntu_hosts">解决 ubuntu 的 /etc/hosts 重启就被还原</a></li>
    
    <li><a href="/2012/10/09/terminator_in_ubuntu_bugfix">terminator在ubuntu下有僵尸进程的解决</a></li>
    
    <li><a href="/2012/11/29/ruby_regex">Ruby正则表达式学习笔记</a></li>
    
    <li><a href="/2013/08/04/git_flow">使用 git flow 进行产品分支的管理</a></li>
    
    <li><a href="/2012/10/12/aqs_1">Java并发同步器AQS(AbstractQueuedSynchronizer)学习笔记(1)</a></li>
    
    <li><a href="/2012/10/12/aqs_2">Java并发同步器AQS(AbstractQueuedSynchronizer)学习笔记(2)</a></li>
    
    </ul>
  
  </li>

  <li id="otherReadTab">
  
    <ul class="circle">
    
    <li><a href="/2012/05/05/using_terminator">terminator的高效使用</a></li>
    
    <li><a href="/2012/10/12/aqs_2">Java并发同步器AQS(AbstractQueuedSynchronizer)学习笔记(2)</a></li>
    
    <li><a href="/2012/07/31/resolved_ubuntu_hosts">解决 ubuntu 的 /etc/hosts 重启就被还原</a></li>
    
    <li><a href="/2011/07/30/unix-io-model">关于IO的同步,异步,阻塞,非阻塞</a></li>
    
    <li><a href="/2012/10/09/terminator_in_ubuntu_bugfix">terminator在ubuntu下有僵尸进程的解决</a></li>
    
    <li><a href="/2012/11/09/liquid">Liquid学习</a></li>
    
    <li><a href="/2012/11/29/ruby_regex">Ruby正则表达式学习笔记</a></li>
    
    <li><a href="/2011/11/17/tokyo-tyrant-vs-redis">Tokyo Tyrant 与 Redis 的一些简单比较</a></li>
    
    <li><a href="/2013/01/09/pattern_intro">模式学习笔记之概述-1</a></li>
    
    <li><a href="/2011/10/22/virtual-memory">内存学习——虚拟内存</a></li>
    
    </ul>
  
  
  </li>
</ul>

<hr/>



  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'zavakid'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






</div>
<!-- End Main Content -->

<!-- Sidebar -->
<aside class="four columns">
<div class="panel">
  <h5>关于Zava</h5>
  <p>程序员, 杭州, Linux, Java, Ruby, Bash, 爱折腾，喜欢开源, 踢业余足球, 听点收音机</p>
  <p>Follow me with:
  <a href="https://github.com/zavakid">github</a>
  <br>more about me:
  <a href="http://about.me/zavakid"> read more</a>
  </p>
</div>
</aside>
<!-- End Sidebar -->

  </div>
  <!-- End Main Content and Sidebar -->
  <!-- Footer -->
  <footer class="row">
<div class="twelve columns">
  <hr />
  <div class="row">
    <div class="eight columns">
      <p>Site content © 2012 - 2013 <a href="http://www.zavakid.com" target="_blank">Zava. Powered by jekyll and jekyllbootstra, customed by Zava</a> <br/>
      host on <a href="http://sae.sina.com.cn" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/120X33_transparent.gif" title="Powered by Sina App Engine"></a></p>
    </div>
    <div class="four columns">
      <ul class="inline-list right">
        
        
        


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/sitemap.txt">网站地图</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  




      </ul>
    </div>
  </div>
</div>
</footer>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-10645202-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





  <!-- End Footer -->
</body>
</html>

